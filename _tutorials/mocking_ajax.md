---
# This file was generated by locco from _tutorials/src/mocking_ajax.js. Do not edit it directly!
layout: tutorial
redirect_from:
    - "/edge/mocking_ajax.html"
order: 
include_docco: true
file_name: "mocking_ajax"
---
<div class="warning" style="margin-bottom: 1em">
    This tutorial describes an approach for mocking AJAX calls that are made via
    <code>XMLHTTPRequest</code>. Most newer codebases use either
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"><code>fetch</code></a>
    or a wrapper library that is more amenable to dependency injection than
    <code>XMLHTTPRequest</code> is. Code using those approaches can be tested
    with Jasmine's built-in spy functionality, as described in
    <a href="/pages/faq.html#ajax">the FAQ</a>.
</div>
<table class="docco" cellspacing="0" cellpadding="0">
    <tbody>
        <tr id="section-Testing_AJAX_calls">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Testing_AJAX_calls">&#182;</a>
                </div>
                <div>
                    <h2>Testing AJAX calls</h2>
<p>We have written a plugin called <a href="https://github.com/pivotal/jasmine-ajax">jasmine-ajax</a>
that allows ajax calls to be mocked out in tests. To use it, you need to
download the <code>mock-ajax.js</code> file and add it to your jasmine helpers so it gets
loaded before any specs that use it.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}describe("mocking ajax", function() { {% endhighlight %}
            </td>
        </tr>
        <tr id="section-Basic_Usage_Across_An_Entire_Suite">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Basic_Usage_Across_An_Entire_Suite">&#182;</a>
                </div>
                <div>
                    <h3>Basic Usage Across An Entire Suite</h3>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}    describe("suite wide usage", function() { {% endhighlight %}
            </td>
        </tr>
        <tr id="section-When_you_want_to_mock_out_all_ajax_calls_across_an_entire_suite,_use">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-When_you_want_to_mock_out_all_ajax_calls_across_an_entire_suite,_use">&#182;</a>
                </div>
                <div>
                    <p>When you want to mock out all ajax calls across an entire suite, use
<code>install()</code> in a <code>beforeEach</code>.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}        beforeEach(function() {
            jasmine.Ajax.install();
        });
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-Because_jasmine-ajax_stubs_out_the_global_XMLHttpRequest_for_the_page,">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Because_jasmine-ajax_stubs_out_the_global_XMLHttpRequest_for_the_page,">&#182;</a>
                </div>
                <div>
                    <p>Because jasmine-ajax stubs out the global XMLHttpRequest for the page,
you&#39;ll want to <code>uninstall()</code> in an <code>afterEach</code> so specs or setup that
expect to make a real ajax request can.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}        afterEach(function() {
            jasmine.Ajax.uninstall();
        });

        it("specifying response when you need it", function() {
            const doneFn = jasmine.createSpy("success");
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-Make_your_requests_as_normal_Jasmine-Ajax_mocks_out_your_request">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Make_your_requests_as_normal_Jasmine-Ajax_mocks_out_your_request">&#182;</a>
                </div>
                <div>
                    <p>Make your requests as normal. Jasmine-Ajax mocks out your request
at the XMLHttpRequest object, so should be compatible with other
libraries that do ajax requests.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(args) {
                if (this.readyState == this.DONE) {
                    doneFn(this.responseText);
                }
            };

            xhr.open("GET", "/some/cool/url");
            xhr.send();
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-At_this_point_the_ajax_request_won&#39;t_have_returned,_so_any">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-At_this_point_the_ajax_request_won&#39;t_have_returned,_so_any">&#182;</a>
                </div>
                <div>
                    <p>At this point the ajax request won&#39;t have returned, so any
assertions about intermediate states (like spinners) can be run
here.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}            expect(jasmine.Ajax.requests.mostRecent().url)
                .toBe('/some/cool/url');
            expect(doneFn).not.toHaveBeenCalled();
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-Now_we_tell_the_request_what_it&#39;s_response_should_look_like">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Now_we_tell_the_request_what_it&#39;s_response_should_look_like">&#182;</a>
                </div>
                <div>
                    <p>Now we tell the request what it&#39;s response should look like</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}            jasmine.Ajax.requests.mostRecent().respondWith({ {% endhighlight %}
            </td>
        </tr>
        <tr id="section-HTTP_response_code">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-HTTP_response_code">&#182;</a>
                </div>
                <div>
                    <p>HTTP response code</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}                "status": 200,
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-You_can_also_specify_the_content_type_of_the_response">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-You_can_also_specify_the_content_type_of_the_response">&#182;</a>
                </div>
                <div>
                    <p>You can also specify the content type of the response</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}                "contentType": 'text/plain',
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-responseText_to_return,_this_should_be_a_string">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-responseText_to_return,_this_should_be_a_string">&#182;</a>
                </div>
                <div>
                    <p>responseText to return, this should be a string.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}                "responseText": 'awesome response'
            });
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-Now_that_we&#39;ve_told_the_request_to_respond,_our_callback_gets">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Now_that_we&#39;ve_told_the_request_to_respond,_our_callback_gets">&#182;</a>
                </div>
                <div>
                    <p>Now that we&#39;ve told the request to respond, our callback gets
called.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}            expect(doneFn).toHaveBeenCalledWith('awesome response');
        });
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-You_can_also_specify_responses_ahead_of_time_and_they_will_respond">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-You_can_also_specify_responses_ahead_of_time_and_they_will_respond">&#182;</a>
                </div>
                <div>
                    <p>You can also specify responses ahead of time and they will respond
immediately when the request is made.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}        it("allows responses to be setup ahead of time", function () {
            const doneFn = jasmine.createSpy("success");
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-Call_stubRequest_with_the_url_you_want_to_return_immediately">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Call_stubRequest_with_the_url_you_want_to_return_immediately">&#182;</a>
                </div>
                <div>
                    <p>Call <code>stubRequest</code> with the url you want to return immediately.
Then <code>andReturn</code> receives the same type of argument as <code>respondWith</code>.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}            jasmine.Ajax.stubRequest('/another/url').andReturn({
                "responseText": 'immediate response'
            });
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-Make_your_requests_as_normal">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-Make_your_requests_as_normal">&#182;</a>
                </div>
                <div>
                    <p>Make your requests as normal</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(args) {
                if (this.readyState == this.DONE) {
                    doneFn(this.responseText);
                }
            };

            xhr.open("GET", "/another/url");
            xhr.send();

            expect(doneFn).toHaveBeenCalledWith('immediate response');
        });
 {% endhighlight %}
            </td>
        </tr>
        <tr id="section-If_you_only_want_to_use_it_in_a_single_spec,_you_can_use_withMock">
            <td class="docs">
                <div class="pilwrap">
                    <a class="pilcrow" href="#section-If_you_only_want_to_use_it_in_a_single_spec,_you_can_use_withMock">&#182;</a>
                </div>
                <div>
                    <p>If you only want to use it in a single spec, you can use <code>withMock</code>.
<code>withMock</code> takes a function that will be called after ajax has been
mocked, and the mock will be uninstalled when the function completes.</p>

                </div>
            </td>
            <td class="code">
                {% highlight javascript %}        it("allows use in a single spec", function() {
            const doneFn = jasmine.createSpy('success');
            jasmine.Ajax.withMock(function() {
                const xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function(args) {
                    if (this.readyState == this.DONE) {
                        doneFn(this.responseText);
                    }
                };

                xhr.open("GET", "/some/cool/url");
                xhr.send();

                expect(doneFn).not.toHaveBeenCalled();

                jasmine.Ajax.requests.mostRecent().respondWith({
                    "status": 200,
                    "responseText": 'in spec response'
                });

                expect(doneFn).toHaveBeenCalledWith('in spec response');
            });
        });
    });
});
 {% endhighlight %}
            </td>
        </tr>
    </tbody>
</table>
